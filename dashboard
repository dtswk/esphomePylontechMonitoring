#raw dashboard configuration using apexcharts to visualize the details.

views:
  - type: sections
    max_columns: 2
    title: Home Power
    path: sections
    sections:
      - type: grid
        cards:
          - type: heading
            heading: Actuals
          - type: tile
            entity: sensor.generator
            layout_options:
              grid_columns: 2
              grid_rows: 1
            visibility:
              - condition: numeric_state
                entity: sensor.generator
                above: 100
            show_entity_picture: false
            color: green
          - type: tile
            entity: sensor.generator_time_left
            visibility:
              - condition: numeric_state
                entity: sensor.generator
                above: 100
            color: green
          - type: gauge
            entity: sensor.battery_percent
            name: Battery
            unit: '%'
            min: 0
            max: 100
            needle: true
            severity:
              green: 80
              yellow: 20
              red: 0
          - type: entities
            entities:
              - entity: sensor.battery_remaining
                name: Time Remaining
              - entity: sensor.power_battery_used_kwh
                name: kWh Used
                icon: mdi:battery-10
              - entity: sensor.power_battery_remaining_kwh
                name: kWh Remaining
                icon: mdi:battery-60
            title: Battery
          - type: custom:mini-graph-card
            hours_to_show: 24
            points_per_hour: 1
            entities:
              - sensor.battery_load
            color_thresholds:
              - value: -12000
                color: '#ff0000'
              - value: -2000
                color: '#ff3300'
              - value: -1
                color: '#ff6666'
              - value: 0
                color: '#009900'
              - value: 12000
                color: '#00cc66'
          - graph: line
            type: sensor
            entity: sensor.net_solar_production
            detail: 2
            hours_to_show: 24
            name: Current Solar
          - graph: line
            type: sensor
            entity: sensor.ac_loads
            detail: 2
            theme: Fluent Red
            hours_to_show: 24
          - type: tile
            entity: sensor.total_daily_solar
            name: Solar In Today
            vertical: false
            icon: mdi:solar-power-variant
            show_entity_picture: false
            layout_options:
              grid_columns: 4
              grid_rows: 1
            hide_state: false
          - type: tile
            entity: sensor.house_hotwater_power
          - type: tile
            entity: sensor.studio_hotwater_power
          - type: tile
            entity: sensor.ev_charger_consumed
            grid_options:
              columns: 6
              rows: 1
            name: EV Power Today
            show_entity_picture: false
            vertical: false
            hide_state: false
            features_position: bottom
          - type: tile
            entity: sensor.ev_charger_load
          - graph: line
            type: sensor
            entity: sensor.hp2551ca_pro_v1_9_3_wh45_humidity
            detail: 2
            name: Master Bath Humidity
            unit: '%'
            theme: Fluent Blue
          - type: tile
            entity: sensor.vsr300_refresh_countdown_time_t
            name: HRV Refresh
            icon: mdi:air-purifier
            vertical: false
            features_position: bottom
            grid_options:
              columns: 6
              rows: 2
          - type: custom:mini-graph-card
            entities:
              - sensor.battery_temp
            show:
              labels: true
            color_thresholds:
              - value: 19
                color: '#0066ff'
              - value: 22
                color: '#339933'
              - value: 25
                color: '#ff0000'
            hours_to_show: 24
            points_per_hour: 1
            name: House Battery Temperature
      - type: grid
        cards:
          - type: heading
            heading: Forecast
          - type: weather-forecast
            entity: weather.forecast_home
            forecast_type: daily
          - type: custom:flex-table-card
            entities:
              include: sensor.solcast_7day_summary
            title: Solar Forecast
            columns:
              - name: Day
                data: summary
                modify: x.Day
                align: center
              - data: summary
                name: Worst kWh
                modify: x.pv10
                align: center
              - data: summary
                name: Estimated kWh
                modify: x.pv
                align: center
            css:
              table+: 'border-collapse: collapse;'
              th+: 'border: 1px solid white;'
              td+: 'border: 1px solid white;'
          - type: custom:apexcharts-card
            apex_config:
              chart:
                height: 350px
              legend:
                show: false
              xaxis:
                labels:
                  datetimeUTC: false
            all_series_config:
              unit: ' kWh'
            header:
              title: Solar forecast best and worst (P10)
              show: true
              standard_format: true
              show_states: true
              colorize_states: true
            graph_span: 3d
            span:
              start: day
              offset: '-0h'
            now:
              show: true
              label: Now
            yaxis:
              - id: kwh
                min: 0
                max: 16
                apex_config:
                  tickAmount: 5
              - id: header_only
                show: false
            series:
              - entity: sensor.solcast_pv_forecast_forecast_today
                yaxis_id: kwh
                type: line
                name: Today P10
                color: red
                group_by:
                  duration: 1h
                  func: sum
                data_generator: >
                  var today = entity.attributes.detailedForecast.map((start,
                  index) => {
                    return [new Date(start["period_start"]).getTime(), entity.attributes.detailedForecast[index]["pv_estimate10"]/2];
                  });

                  var data = today

                  return data;
                show:
                  legend_value: false
                  in_header: false
                stroke_width: 3
                float_precision: 2
                extend_to: false
              - entity: sensor.solcast_pv_forecast_forecast_today
                yaxis_id: kwh
                type: area
                name: Today
                color: orange
                group_by:
                  duration: 1h
                  func: sum
                data_generator: >
                  var today = entity.attributes.detailedForecast.map((start,
                  index) => {
                    return [new Date(start["period_start"]).getTime(), entity.attributes.detailedForecast[index]["pv_estimate"]/2];
                  });

                  var data = today

                  return data;
                show:
                  legend_value: false
                  in_header: false
                stroke_width: 3
                float_precision: 2
                extend_to: false
              - entity: sensor.solcast_pv_forecast_forecast_tomorrow
                yaxis_id: kwh
                type: line
                name: Tomorrow P10
                color: silver
                group_by:
                  duration: 1h
                  func: sum
                data_generator: >
                  var today = entity.attributes.detailedForecast.map((start,
                  index) => {
                    return [new Date(start["period_start"]).getTime(), entity.attributes.detailedForecast[index]["pv_estimate10"]/2];
                  });

                  var data = today

                  return data;
                show:
                  legend_value: false
                  in_header: false
                stroke_width: 3
                float_precision: 2
                extend_to: false
              - entity: sensor.solcast_pv_forecast_forecast_tomorrow
                yaxis_id: kwh
                type: area
                name: Tomorrow
                color: grey
                group_by:
                  duration: 1h
                  func: sum
                data_generator: >
                  var today = entity.attributes.detailedForecast.map((start,
                  index) => {
                    return [new Date(start["period_start"]).getTime(), entity.attributes.detailedForecast[index]["pv_estimate"]/2];
                  });

                  var data = today

                  return data;
                show:
                  legend_value: false
                  in_header: false
                stroke_width: 3
                float_precision: 2
                extend_to: false
              - entity: sensor.solcast_pv_forecast_forecast_day_3
                yaxis_id: kwh
                type: line
                name: Day After P10
                color: silver
                group_by:
                  duration: 1h
                  func: sum
                data_generator: >
                  var today = entity.attributes.detailedForecast.map((start,
                  index) => {
                    return [new Date(start["period_start"]).getTime(), entity.attributes.detailedForecast[index]["pv_estimate10"]/2];
                  });

                  var data = today

                  return data;
                show:
                  legend_value: false
                  in_header: false
                stroke_width: 3
                float_precision: 2
                extend_to: false
              - entity: sensor.solcast_pv_forecast_forecast_day_3
                yaxis_id: kwh
                type: area
                name: Day after
                color: grey
                group_by:
                  duration: 1h
                  func: sum
                data_generator: >
                  var today = entity.attributes.detailedForecast.map((start,
                  index) => {
                    return [new Date(start["period_start"]).getTime(), entity.attributes.detailedForecast[index]["pv_estimate"]/2];
                  });

                  var data = today

                  return data;
                show:
                  legend_value: false
                  in_header: false
                stroke_width: 3
                float_precision: 2
                extend_to: false
              - entity: sensor.solcast_pv_forecast_p10_remaining_today
                yaxis_id: header_only
                name: Remaining Today P10
                color: red
                show:
                  legend_value: true
                  in_header: true
                  in_chart: false
              - entity: sensor.solcast_pv_forecast_forecast_remaining_today
                yaxis_id: header_only
                name: Remaining Today
                color: orange
                show:
                  legend_value: true
                  in_header: true
                  in_chart: false
          - type: tile
            entity: sensor.solcast_pv_forecast_api_last_polled
            name: Solcast Last Update
          - type: tile
            entity: sensor.solcast_pv_forecast_api_used
            name: API Used
      - type: grid
        cards:
          - type: heading
            heading: Cat Shed
          - graph: line
            type: sensor
            entity: sensor.cat_shed_battery_percent
            detail: 1
            theme: Fluent Slate
            hours_to_show: 24
          - graph: line
            type: sensor
            entity: sensor.cat_shed_ac_loads
            detail: 2
            theme: Fluent Red
            hours_to_show: 24
          - graph: line
            type: sensor
            entity: sensor.cat_shed_net_solar_production
            detail: 2
            name: Cat Shed Solar
            hours_to_show: 24
          - graph: line
            type: sensor
            entity: sensor.cat_shed_battery_temp
            detail: 1
            theme: Fluent Blue
            hours_to_show: 24
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: entities
                entities:
                  - entity: switch.tapo_power_02
                    name: 240V EV Charger
                  - entity: sensor.tapo_power_02_current_consumption
                    name: Usage now
                  - entity: sensor.tapo_power_02_today_s_consumption
                    name: Today
                  - entity: sensor.tapo_power_02_this_month_s_consumption
                    name: This month
                state_color: true
              - type: entities
                entities:
                  - entity: input_number.kia_battery_percent_cut_off
                    name: Stop
                state_color: true
                title: Rules - House Battery Percent
            title: Kia charging controls
    cards: []
  - title: Configuration
    path: configuration
    type: sections
    sections:
      - type: grid
        cards:
          - type: heading
            heading: Battery Capacity and Excess
          - type: tile
            entity: input_number.power_battery_capacity
          - type: tile
            entity: input_number.power_typical_daily_kwh
            name: Typical Daily Use
          - type: tile
            entity: input_boolean.power_use_excess_for_house_air_con
            name: Excess for House Air Con
          - type: tile
            entity: input_boolean.power_use_excess_for_power_room_air_con
            name: Excess for Power Room Air Con
          - type: tile
            entity: input_boolean.power_use_excess_for_studio_hotwater
            name: Excess for Studio Hotwater
          - type: tile
            entity: input_boolean.studio_hotwater_override
            icon: mdi:toggle-switch-variant
            features_position: bottom
            vertical: false
            name: Studio HW Override
      - type: grid
        cards:
          - type: heading
            heading: Battery State
          - type: tile
            entity: sensor.battery_percent
          - type: tile
            entity: input_boolean.power_excess
          - type: tile
            entity: input_boolean.power_low
          - square: false
            type: grid
            cards:
              - type: tile
                entity: sensor.net_solar_production
              - type: tile
                entity: sensor.solar_now_average
              - type: tile
                entity: sensor.power_battery_used_kwh
                name: Used
              - type: tile
                entity: sensor.solcast_pv_forecast_p10_remaining_today
                name: Remaining P10
              - type: tile
                entity: sensor.solcast_pv_forecast_forecast_remaining_today
                name: Remaining
            title: Triggers
            columns: 2
      - type: grid
        cards:
          - type: heading
            heading: Excess Start
          - type: tile
            entity: input_number.excess_battery_percent_start
            layout_options:
              grid_columns: 4
              grid_rows: 1
            name: Minimum start percent
          - type: tile
            entity: input_number.excess_solar_w_start
            layout_options:
              grid_columns: 4
              grid_rows: 1
            name: Minimum solar starting
          - type: tile
            entity: input_number.excess_extra_kwh_start
            layout_options:
              grid_columns: 4
              grid_rows: 1
            name: Minimum forecasted excess power for the day
          - type: tile
            entity: input_number.excess_extra_kwh_p10_start
            layout_options:
              grid_columns: 4
              grid_rows: 1
            name: Minimum P10 forecast excess for the day
          - type: tile
            entity: input_number.excess_battery_percent_on
            layout_options:
              grid_columns: 4
              grid_rows: 1
            name: Percent to automatically turn on
          - type: tile
            entity: input_number.kia_battery_percent_start
            grid_options:
              columns: full
            name: KIA Early Start Percent
            show_entity_picture: false
            vertical: false
            hide_state: false
      - type: grid
        cards:
          - type: heading
            heading: Excess Stop
          - type: tile
            entity: input_number.excess_battery_percent_stop
            layout_options:
              grid_columns: 4
              grid_rows: 1
          - type: tile
            entity: input_number.excess_solar_w_stop
            layout_options:
              grid_columns: 4
              grid_rows: 1
          - type: tile
            entity: input_number.excess_extra_kwh_stop
            layout_options:
              grid_columns: 4
              grid_rows: 1
      - type: grid
        cards:
          - type: heading
            heading: Hotwater
            heading_style: title
          - type: tile
            entity: switch.house_hotwater
            icon_tap_action:
              action: none
            state_content: last-changed
          - type: tile
            entity: switch.studio_hotwater
            icon_tap_action:
              action: none
            state_content: last-changed
          - type: tile
            entity: sensor.house_hotwater_power
            features_position: bottom
            vertical: false
          - type: tile
            entity: sensor.studio_hotwater_power
            features_position: bottom
            vertical: false
  - title: Today Detailed
    path: d
    cards:
      - type: custom:apexcharts-card
        update_interval: 1min
        header:
          title: Solar forecast
          show: true
          show_states: true
          colorize_states: true
        apex_config:
          chart:
            height: 500px
          tooltip:
            enabled: true
            shared: true
            intersect: false
            followCursor: true
            x:
              format: HH:mm
        now:
          show: true
          label: Now
        graph_span: 14h
        span:
          start: day
          offset: +5h
        yaxis:
          - id: capacity
            show: true
            opposite: true
            decimals: 0
            max: 100
            min: 0
            apex_config:
              tickAmount: 10
          - id: kWh
            show: true
            min: 0
            apex_config:
              tickAmount: 10
          - id: header_only
            show: false
        series:
          - entity: sensor.battery_percent
            yaxis_id: capacity
            type: line
            stroke_width: 2
            float_precision: 2
            color: DarkGreen
            extend_to: now
            group_by:
              func: avg
              duration: 30m
          - entity: sensor.net_solar_production
            transform: return x / 1000;
            name: Solar Power (now)
            type: line
            stroke_width: 2
            float_precision: 2
            color: Orange
            yaxis_id: kWh
            unit: kW
            extend_to: now
            show:
              legend_value: true
              in_header: true
            group_by:
              func: avg
              duration: 30m
          - entity: sensor.solcast_pv_forecast_forecast_today
            name: Forecast
            color: Grey
            opacity: 0.3
            stroke_width: 0
            type: area
            extend_to: false
            group_by:
              func: avg
              duration: 30m
            yaxis_id: kWh
            show:
              legend_value: false
              in_header: false
            data_generator: |
              return entity.attributes.detailedForecast.map((entry) => {
                    return [new Date(entry.period_start), entry.pv_estimate];
                  });
          - entity: sensor.solcast_pv_forecast_forecast_today
            name: Forecast 10%
            color: Grey
            opacity: 0.3
            stroke_width: 0
            type: area
            extend_to: false
            group_by:
              func: avg
              duration: 30m
            yaxis_id: kWh
            show:
              legend_value: false
              in_header: false
            data_generator: |
              return entity.attributes.detailedForecast.map((entry) => {
                    return [new Date(entry.period_start), entry.pv_estimate10];
                  });
          - entity: sensor.total_daily_solar
            yaxis_id: header_only
            name: Total Solar Today
            stroke_width: 2
            color: Orange
            show:
              legend_value: true
              in_header: true
              in_chart: false
          - entity: sensor.solcast_pv_forecast_forecast_today
            yaxis_id: header_only
            name: Today Forecast
            color: Grey
            show:
              legend_value: true
              in_header: true
              in_chart: false
          - entity: sensor.solcast_pv_forecast_forecast_today
            attribute: estimate10
            yaxis_id: header_only
            name: Today Forecast 10%
            color: Grey
            opacity: 0.3
            show:
              legend_value: true
              in_header: true
              in_chart: false
          - entity: sensor.solcast_pv_forecast_forecast_remaining_today
            yaxis_id: header_only
            name: Remaining
            color: Grey
            show:
              legend_value: true
              in_header: true
              in_chart: false
    type: panel
  - type: sections
    max_columns: 3
    title: House Power Monitoring
    path: house-power-monitoring
    icon: mdi:monitor-dashboard
    sections:
      - type: grid
        cards:
          - type: heading
            heading: House Shelly Power Meter
            heading_style: title
          - type: tile
            entity: sensor.shelly_power_meter_1_em0_power
            grid_options:
              columns: full
              rows: 1
            name: Lights
          - type: tile
            entity: sensor.shelly_power_meter_1_em1_power
            grid_options:
              columns: full
            name: Power 1
          - type: tile
            entity: sensor.shelly_power_meter_2_em0_power
            grid_options:
              columns: full
            name: Power 2
          - type: tile
            entity: sensor.shelly_power_meter_2_em1_power
            grid_options:
              columns: full
            name: Power 3
          - type: tile
            grid_options:
              columns: full
            entity: sensor.shelly_power_meter_3_em0_power
            vertical: false
            features_position: bottom
          - type: tile
            grid_options:
              columns: full
            entity: sensor.shelly_power_meter_3_em1_power
            vertical: false
            features_position: bottom
          - type: tile
            entity: sensor.shelly_power_meter_4_em0_power
            grid_options:
              columns: full
            name: Heat Recovery
          - type: tile
            entity: sensor.shelly_power_meter_4_em1_power
            grid_options:
              columns: full
            name: House Hotwater
          - type: tile
            entity: sensor.shelly_power_meter_5_em0_power
            grid_options:
              columns: full
            name: Cooktop
          - type: tile
            entity: sensor.shelly_power_meter_5_em1_power
            grid_options:
              columns: full
            name: House Airconditioner
      - type: grid
        cards:
          - type: heading
            heading: New section
          - type: history-graph
            entities:
              - entity: sensor.shelly_power_meter_1_em0_power
            title: Lights Power Usage Charts
      - type: grid
        cards:
          - type: heading
            heading: New section
          - type: history-graph
            entities:
              - entity: sensor.shelly_power_meter_1_em1_power
              - entity: sensor.shelly_power_meter_2_em0_power
              - entity: sensor.shelly_power_meter_2_em1_power
            title: Power Points
      - type: grid
        cards:
          - type: heading
            heading: New section
          - type: history-graph
            entities:
              - entity: sensor.shelly_power_meter_3_em0_power
              - entity: sensor.shelly_power_meter_5_em0_power
            title: Kitchen
      - type: grid
        cards:
          - type: heading
            heading: New section
          - type: history-graph
            entities:
              - entity: sensor.shelly_power_meter_3_em1_power
              - entity: sensor.shelly_power_meter_4_em0_power
              - entity: sensor.shelly_power_meter_4_em1_power
              - entity: sensor.shelly_power_meter_5_em1_power
            title: Utility
      - type: grid
        cards:
          - type: heading
            heading: House Shed / Studio Power Meters
            heading_style: title
          - type: entities
            entities:
              - entity: sensor.shelly_power_meter_studio_1_em0_power
              - entity: sensor.shelly_power_meter_studio_1_em1_power
              - entity: sensor.shelly_power_meter_studio_2_em0_power
              - entity: sensor.shelly_power_meter_studio_2_em1_power
              - entity: sensor.shelly_power_meter_studio_3_em0_power
              - entity: sensor.shelly_power_meter_studio_3_em1_power
  - type: sections
    max_columns: 4
    title: Cat BMS
    path: cat-bms
    icon: ''
    sections:
      - type: grid
        cards:
          - type: heading
            heading: DL-40D63C34995A
          - type: tile
            entity: sensor.dl_40d63c34995a_battery
          - type: tile
            entity: binary_sensor.dl_40d63c34995a_charging
          - type: tile
            entity: sensor.dl_40d63c34995a_current
          - type: tile
            entity: sensor.dl_40d63c34995a_cycles
          - type: tile
            entity: sensor.dl_40d63c34995a_power
          - type: tile
            entity: sensor.dl_40d63c34995a_runtime
          - type: tile
            entity: sensor.dl_40d63c34995a_stored_energy
          - type: tile
            entity: sensor.dl_40d63c34995a_temperature
          - type: tile
            entity: sensor.dl_40d63c34995a_voltage
      - type: grid
        cards:
          - type: heading
            heading: DL-40D63C34995A
          - type: tile
            entity: sensor.dl_40d63c34995a_delta_voltage
            vertical: true
            name: Cell Delta Voltage
          - type: tile
            entity: sensor.sensor_dl_40d63c34995a_voltage_max
            vertical: true
            name: Cell Max Voltage
          - type: history-graph
            entities:
              - entity: sensor.dl_40d63c34995a_delta_voltage
            title: Cell voltage difference
            hours_to_show: 72
          - type: history-graph
            entities:
              - entity: sensor.dl_40d63c34995a_voltage
            hours_to_show: 72
            title: Battery Voltage
          - type: history-graph
            entities:
              - entity: sensor.dl_40d63c34995a_current
            hours_to_show: 72
            title: Battery Voltage
    cards: []
  - type: sections
    max_columns: 2
    title: EV
    path: ev
    icon: mdi:ev-station
    sections:
      - type: grid
        cards:
          - type: picture-elements
            elements:
              - type: state-label
                entity: sensor.ev_charger_state
                style:
                  left: 50%
                  top: 7%
                  font-weight: bold
                  font-size: 24px
              - type: state-label
                style:
                  left: 60%
                  top: 17%
                  font-weight: bold
                  font-size: 16px
                entity: sensor.ev_charger_mode
              - type: state-label
                entity: sensor.ev_realtime_current
                style:
                  left: 67%
                  top: 24%
                  font-weight: bold
                  font-size: 16px
              - type: state-label
                entity: sensor.ev_charger_load
                style:
                  left: 67%
                  top: 31%
                  font-weight: bold
                  font-size: 16px
              - type: state-label
                entity: sensor.cerbo_gx_ev_charger_charge_time
                style:
                  left: 63%
                  top: 38%
                  font-weight: bold
                  font-size: 14px
              - type: state-label
                entity: sensor.net_solar_production
                style:
                  left: 18%
                  top: 70%
                  font-weight: bold
                  font-size: 22px
              - type: state-label
                entity: sensor.ac_loads
                style:
                  left: 52%
                  top: 70%
                  font-weight: bold
                  font-size: 22px
              - type: state-label
                entity: sensor.battery_percent
                style:
                  left: 85%
                  top: 70%
                  font-weight: bold
                  font-size: 22px
              - type: state-label
                entity: sensor.solcast_pv_forecast_p10_remaining_today
                style:
                  left: 66%
                  top: 88%
                  font-weight: bold
                  font-size: 14px
              - type: state-label
                entity: sensor.solcast_pv_forecast_forecast_remaining_today
                style:
                  left: 90%
                  top: 88%
                  font-weight: bold
                  font-size: 14px
              - type: state-label
                entity: sensor.solcast_pv_forecast_p10_tomorrow
                style:
                  left: 64%
                  top: 95%
                  font-weight: bold
                  font-size: 14px
              - type: state-label
                entity: sensor.solcast_pv_forecast_forecast_tomorrow
                style:
                  left: 88%
                  top: 95%
                  font-weight: bold
                  font-size: 14px
            image: /api/image/serve/eb2c3efacb8923ebdb654d3a204ce24e/512x512
            dark_mode_image: /api/image/serve/aa1bafb27905173f8decd8ee55f28f71/512x512
          - type: tile
            grid_options:
              columns: full
            entity: sensor.ev_charger_consumed
            name: EV this charge
            show_entity_picture: false
            hide_state: false
            vertical: false
            features_position: bottom
      - type: grid
        cards:
          - type: heading
            heading: Set EV Charger
            heading_style: title
          - type: tile
            entity: switch.cerbo_gx_ev_charger_start_stop
            grid_options:
              columns: 6
              rows: 2
            name: EV Charger Start Stop
            show_entity_picture: false
            vertical: true
            hide_state: false
          - features:
              - type: numeric-input
                style: buttons
            type: tile
            entity: number.cerbo_gx_ev_charger_set_current
            grid_options:
              columns: 6
              rows: 2
            name: Charger Amps
            show_entity_picture: false
            vertical: false
            hide_state: true
          - type: custom:mushroom-select-card
            entity: input_select.ev_charger_mode
            grid_options:
              columns: 6
              rows: 2
            secondary_info: none
          - show_name: true
            show_icon: true
            type: button
            tap_action:
              action: perform-action
              perform_action: script.ev_charger_change_mode
              target: {}
            entity: script.ev_charger_change_mode
            icon: mdi:button-pointer
            show_state: false
            grid_options:
              columns: 6
              rows: 2
            hold_action:
              action: none
            name: Click to Set Charge Mode
            icon_height: 40px
          - type: entities
            entities:
              - entity: input_number.kia_battery_percent_cut_off
                name: Stop
            state_color: true
            title: 'Stop manual charging at this percent '
          - type: tile
            entity: input_number.power_typical_daily_kwh
            vertical: true
            tap_action:
              action: none
            icon_tap_action:
              action: none
            hold_action:
              action: none
            name: P10 power required
            show_entity_picture: false
      - type: grid
        cards:
          - type: heading
            heading: EV Charger
            heading_style: title
            icon: mdi:ev-station
          - type: history-graph
            entities:
              - entity: sensor.ev_charger_load
            hours_to_show: 24
          - type: history-graph
            entities:
              - entity: sensor.ev_charger_state
            hours_to_show: 48
            title: EV Charging State
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: markdown
                content: >-
                  This is used to control the little AC charger, not the main
                  one.
              - type: entities
                entities:
                  - entity: switch.tapo_power_02
                  - entity: sensor.tapo_power_02_current_consumption
                    name: Usage now
                state_color: true
            title: Small EV Charger controls
  - type: sections
    max_columns: 2
    title: Coop
    path: coop
    icon: fab:earlybirds
    sections:
      - type: grid
        cards:
          - type: heading
            heading: Coop Victron MPPT
            heading_style: title
            icon: mdi:solar-power-variant-outline
          - type: tile
            entity: sensor.coop_monitor_mppt_error_reason
            name:
              type: entity
            vertical: false
            features_position: bottom
          - type: tile
            entity: binary_sensor.coop_monitor_mppt_has_error
            name:
              type: entity
            vertical: false
            features_position: bottom
          - type: tile
            entity: binary_sensor.coop_monitor_mppt_is_in_fault_state
            name:
              type: entity
            vertical: false
            features_position: bottom
          - type: tile
            entity: sensor.coop_monitor_mppt_load_current
            name:
              type: entity
            vertical: false
            features_position: bottom
          - type: tile
            entity: sensor.coop_monitor_mppt_output_current
            name:
              type: entity
            vertical: false
            features_position: bottom
          - type: tile
            entity: sensor.coop_monitor_mppt_output_voltage
            name:
              type: entity
            vertical: false
            features_position: bottom
          - type: tile
            entity: sensor.coop_monitor_mppt_yield_today
            name:
              type: entity
            vertical: false
            features_position: bottom
      - type: grid
        cards:
          - type: heading
            heading_style: title
            heading: 'Power Generation '
          - type: gauge
            entity: sensor.coop_monitor_mppt_output_voltage
            min: 11.63
            max: 12.89
            needle: true
            severity:
              green: 12.65
              yellow: 12.23
              red: 11.63
          - type: tile
            entity: sensor.coop_monitor_mppt_state
            name:
              type: entity
            vertical: false
            features_position: bottom
          - type: tile
            entity: sensor.coop_monitor_mppt_pv_power
            name:
              type: entity
            vertical: false
            features_position: bottom
          - type: tile
            grid_options:
              columns: full
            entity: sensor.coop_monitor_mppt_yield_today
            name:
              type: entity
            vertical: false
            features_position: bottom
          - type: history-graph
            entities:
              - entity: sensor.coop_monitor_mppt_pv_power
                name:
                  type: entity
            hours_to_show: 96
            title: PV Watts
          - type: heading
            icon: mdi:fridge
            heading_style: title
            heading: 'Power Consumption '
          - type: tile
            entity: sensor.tapo_power_06_current_consumption
            name: Current Power
            vertical: false
            features_position: bottom
          - type: tile
            entity: sensor.tapo_power_06_today_s_consumption
            name:
              type: entity
            vertical: false
            features_position: bottom
      - type: grid
        cards:
          - type: heading
            heading: New section
          - type: tile
            entity: camera.e1_house_shed_fluent_2
            show_entity_picture: true
            vertical: false
            features_position: bottom
          - type: tile
            entity: binary_sensor.e1_house_shed_motion_2
          - type: tile
            entity: binary_sensor.e1_house_shed_person_2
          - type: tile
            entity: binary_sensor.e1_house_shed_pet_2
  - type: sections
    max_columns: 1
    title: Pylontech
    path: pylontech
    icon: mdi:battery-charging-30
    sections:
      - type: grid
        cards:
          - type: heading
            heading: New section
          - type: custom:apexcharts-card
            header:
              show: true
              title: State of Charge (SoC) - 15 Packs
              show_states: true
              colorize_states: true
            graph_span: 1d
            all_series_config:
              stroke_width: 1.5
              opacity: 0.8
              type: line
              curve: smooth
            series:
              - entity: sensor.pylontech_monitor_battery1_soc
                name: Bat 1
              - entity: sensor.pylontech_monitor_battery2_soc
                name: Bat 2
              - entity: sensor.pylontech_monitor_battery3_soc
                name: Bat 3
              - entity: sensor.pylontech_monitor_battery4_soc
                name: Bat 4
              - entity: sensor.pylontech_monitor_battery5_soc
                name: Bat 5
              - entity: sensor.pylontech_monitor_battery6_soc
                name: Bat 6
              - entity: sensor.pylontech_monitor_battery7_soc
                name: Bat 7
              - entity: sensor.pylontech_monitor_battery8_soc
                name: Bat 8
              - entity: sensor.pylontech_monitor_battery9_soc
                name: Bat 9
              - entity: sensor.pylontech_monitor_battery10_soc
                name: Bat 10
              - entity: sensor.pylontech_monitor_battery11_soc
                name: Bat 11
              - entity: sensor.pylontech_monitor_battery12_soc
                name: Bat 12
              - entity: sensor.pylontech_monitor_battery13_soc
                name: Bat 13
              - entity: sensor.pylontech_monitor_battery14_soc
                name: Bat 14
              - entity: sensor.pylontech_monitor_battery15_soc
                name: Bat 15
          - type: custom:apexcharts-card
            header:
              show: true
              title: Lowest Cell Voltage - 15 Packs
              show_states: true
              colorize_states: true
            graph_span: 1d
            all_series_config:
              stroke_width: 1.5
              opacity: 0.8
              type: line
              curve: smooth
            series:
              - entity: sensor.pylontech_monitor_battery1_lowest_cell_voltage
                name: Bat 1
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery2_lowest_cell_voltage
                name: Bat 2
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery3_lowest_cell_voltage
                name: Bat 3
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery4_lowest_cell_voltage
                name: Bat 4
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery5_lowest_cell_voltage
                name: Bat 5
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery6_lowest_cell_voltage
                name: Bat 6
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery7_lowest_cell_voltage
                name: Bat 7
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery8_lowest_cell_voltage
                name: Bat 8
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery9_lowest_cell_voltage
                name: Bat 9
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery10_lowest_cell_voltage
                name: Bat 10
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery11_lowest_cell_voltage
                name: Bat 11
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery12_lowest_cell_voltage
                name: Bat 12
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery13_lowest_cell_voltage
                name: Bat 13
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery14_lowest_cell_voltage
                name: Bat 14
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery15_lowest_cell_voltage
                name: Bat 15
                float_precision: 3
          - type: custom:apexcharts-card
            header:
              show: true
              title: Highest Cell Voltage - 15 Packs
              show_states: true
              colorize_states: true
            graph_span: 1d
            all_series_config:
              stroke_width: 1.5
              opacity: 0.8
              type: line
              curve: smooth
            series:
              - entity: sensor.pylontech_monitor_battery1_highest_cell_voltage
                name: Bat 1
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery2_highest_cell_voltage
                name: Bat 2
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery3_highest_cell_voltage
                name: Bat 3
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery4_highest_cell_voltage
                name: Bat 4
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery5_highest_cell_voltage
                name: Bat 5
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery6_highest_cell_voltage
                name: Bat 6
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery7_highest_cell_voltage
                name: Bat 7
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery8_highest_cell_voltage
                name: Bat 8
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery9_highest_cell_voltage
                name: Bat 9
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery10_highest_cell_voltage
                name: Bat 10
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery11_highest_cell_voltage
                name: Bat 11
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery12_highest_cell_voltage
                name: Bat 12
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery13_highest_cell_voltage
                name: Bat 13
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery14_highest_cell_voltage
                name: Bat 14
                float_precision: 3
              - entity: sensor.pylontech_monitor_battery15_highest_cell_voltage
                name: Bat 15
                float_precision: 3
          - type: custom:apexcharts-card
            header:
              show: true
              title: Cell Imbalance - 15 Packs
              show_states: true
              colorize_states: true
            graph_span: 1d
            all_series_config:
              stroke_width: 1.5
              opacity: 0.8
              type: line
              curve: smooth
            series:
              - entity: sensor.battery1_cell_imbalance
                name: Bat 1
                float_precision: 3
              - entity: sensor.battery2_cell_imbalance
                name: Bat 2
                float_precision: 3
              - entity: sensor.battery3_cell_imbalance
                name: Bat 3
                float_precision: 3
              - entity: sensor.battery4_cell_imbalance
                name: Bat 4
                float_precision: 3
              - entity: sensor.battery5_cell_imbalance
                name: Bat 5
                float_precision: 3
              - entity: sensor.battery6_cell_imbalance
                name: Bat 6
                float_precision: 3
              - entity: sensor.battery7_cell_imbalance
                name: Bat 7
                float_precision: 3
              - entity: sensor.battery8_cell_imbalance
                name: Bat 8
                float_precision: 3
              - entity: sensor.battery9_cell_imbalance
                name: Bat 9
                float_precision: 3
              - entity: sensor.battery10_cell_imbalance
                name: Bat 10
                float_precision: 3
              - entity: sensor.battery11_cell_imbalance
                name: Bat 11
                float_precision: 3
              - entity: sensor.battery12_cell_imbalance
                name: Bat 12
                float_precision: 3
              - entity: sensor.battery13_cell_imbalance
                name: Bat 13
                float_precision: 3
              - entity: sensor.battery14_cell_imbalance
                name: Bat 14
                float_precision: 3
              - entity: sensor.battery15_cell_imbalance
                name: Bat 15
                float_precision: 3
